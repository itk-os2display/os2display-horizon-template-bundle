/**
 * @name os2displayhorizontemplatebundle
 * @version v2.0.0
 * @link https://github.com/os2display/horizon-template-bundle
 */
angular.module("toolsModule").directive("horizonEditor",["mediaFactory","$timeout",function(n,e){return{restrict:"E",replace:!0,scope:{slide:"=",close:"&"},link:function(l){var t=null;l.step=null,l.selectedMedia=[],l.backgroundPicker=function(e){t=e,l.step="background-picker"},l.pickFromMedia=function(){var e=l.slide.options.regions[t];""!==e.mediaIndex&&null!==e.mediaIndex&&void 0!==e.mediaIndex&&(l.selectedMedia=[l.slide.media[e.mediaIndex]]),l.step="pick-from-media"},l.pickFromComputer=function(){l.step="pick-from-computer"},l.back=function(){l.selectedMedia=[],l.step=null,t=null};function d(e){var i=[],d=!1,n=null;for(var o in l.slide.media){var s=l.slide.media[o];s.id===e.id&&(d=!0,n=o),i.push(s)}d||(i.push(e),n=i.length-1),l.step=null,l.slide.media=i,l.slide.options.regions[t].mediaIndex=n,function(){for(var e=l.slide.options.regions.reduce(function(e,i){return""!==i.mediaIndex&&null!==i.mediaIndex&&void 0!==i.mediaIndex&&-1===e.indexOf(i.mediaIndex)&&e.push(i.mediaIndex),e},[]),i=[],d=0;d<l.slide.media.length;d++)if(-1===e.indexOf(d))for(var n in l.slide.options.regions)(n=l.slide.options.regions[n]).mediaIndex>d&&(n.mediaIndex=n.mediaIndex-1);else i.push(l.slide.media[d]);l.slide.media=i}()}l.$on("mediaOverview.selectMedia",function(e,i){d(i)}),l.$on("mediaUpload.uploadSuccess",function(e,i){n.getMedia(i.id).then(function(e){l.slide.media.push(e),l.slide.options.regions[t].mediaIndex=l.slide.media.length-1},function(e){busService.$emit("log.error",{cause:e,msg:"Kunne ikke tilf√∏je media."})}),i.queue.find(function(e,i){return!e.isSuccess})||l.close()})},templateUrl:"/bundles/os2displayhorizontemplate/apps/toolsModule/horizon-editor.html"}}]);